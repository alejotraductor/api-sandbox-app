{"ast":null,"code":"/** PURE_IMPORTS_START _util_isArray,_util_isObject,_util_isFunction,_util_tryCatch,_util_errorObject,_util_UnsubscriptionError PURE_IMPORTS_END */\nimport { isArray } from './util/isArray';\nimport { isObject } from './util/isObject';\nimport { isFunction } from './util/isFunction';\nimport { tryCatch } from './util/tryCatch';\nimport { errorObject } from './util/errorObject';\nimport { UnsubscriptionError } from './util/UnsubscriptionError';\n\nvar Subscription = /*@__PURE__*/function () {\n  function Subscription(unsubscribe) {\n    this.closed = false;\n    this._parent = null;\n    this._parents = null;\n    this._subscriptions = null;\n\n    if (unsubscribe) {\n      this._unsubscribe = unsubscribe;\n    }\n  }\n\n  Subscription.prototype.unsubscribe = function () {\n    var hasErrors = false;\n    var errors;\n\n    if (this.closed) {\n      return;\n    }\n\n    var _a = this,\n        _parent = _a._parent,\n        _parents = _a._parents,\n        _unsubscribe = _a._unsubscribe,\n        _subscriptions = _a._subscriptions;\n\n    this.closed = true;\n    this._parent = null;\n    this._parents = null;\n    this._subscriptions = null;\n    var index = -1;\n    var len = _parents ? _parents.length : 0;\n\n    while (_parent) {\n      _parent.remove(this);\n\n      _parent = ++index < len && _parents[index] || null;\n    }\n\n    if (isFunction(_unsubscribe)) {\n      var trial = tryCatch(_unsubscribe).call(this);\n\n      if (trial === errorObject) {\n        hasErrors = true;\n        errors = errors || (errorObject.e instanceof UnsubscriptionError ? flattenUnsubscriptionErrors(errorObject.e.errors) : [errorObject.e]);\n      }\n    }\n\n    if (isArray(_subscriptions)) {\n      index = -1;\n      len = _subscriptions.length;\n\n      while (++index < len) {\n        var sub = _subscriptions[index];\n\n        if (isObject(sub)) {\n          var trial = tryCatch(sub.unsubscribe).call(sub);\n\n          if (trial === errorObject) {\n            hasErrors = true;\n            errors = errors || [];\n            var err = errorObject.e;\n\n            if (err instanceof UnsubscriptionError) {\n              errors = errors.concat(flattenUnsubscriptionErrors(err.errors));\n            } else {\n              errors.push(err);\n            }\n          }\n        }\n      }\n    }\n\n    if (hasErrors) {\n      throw new UnsubscriptionError(errors);\n    }\n  };\n\n  Subscription.prototype.add = function (teardown) {\n    if (!teardown || teardown === Subscription.EMPTY) {\n      return Subscription.EMPTY;\n    }\n\n    if (teardown === this) {\n      return this;\n    }\n\n    var subscription = teardown;\n\n    switch (typeof teardown) {\n      case 'function':\n        subscription = new Subscription(teardown);\n\n      case 'object':\n        if (subscription.closed || typeof subscription.unsubscribe !== 'function') {\n          return subscription;\n        } else if (this.closed) {\n          subscription.unsubscribe();\n          return subscription;\n        } else if (typeof subscription._addParent !== 'function') {\n          var tmp = subscription;\n          subscription = new Subscription();\n          subscription._subscriptions = [tmp];\n        }\n\n        break;\n\n      default:\n        throw new Error('unrecognized teardown ' + teardown + ' added to Subscription.');\n    }\n\n    var subscriptions = this._subscriptions || (this._subscriptions = []);\n    subscriptions.push(subscription);\n\n    subscription._addParent(this);\n\n    return subscription;\n  };\n\n  Subscription.prototype.remove = function (subscription) {\n    var subscriptions = this._subscriptions;\n\n    if (subscriptions) {\n      var subscriptionIndex = subscriptions.indexOf(subscription);\n\n      if (subscriptionIndex !== -1) {\n        subscriptions.splice(subscriptionIndex, 1);\n      }\n    }\n  };\n\n  Subscription.prototype._addParent = function (parent) {\n    var _a = this,\n        _parent = _a._parent,\n        _parents = _a._parents;\n\n    if (!_parent || _parent === parent) {\n      this._parent = parent;\n    } else if (!_parents) {\n      this._parents = [parent];\n    } else if (_parents.indexOf(parent) === -1) {\n      _parents.push(parent);\n    }\n  };\n\n  Subscription.EMPTY = function (empty) {\n    empty.closed = true;\n    return empty;\n  }(new Subscription());\n\n  return Subscription;\n}();\n\nexport { Subscription };\n\nfunction flattenUnsubscriptionErrors(errors) {\n  return errors.reduce(function (errs, err) {\n    return errs.concat(err instanceof UnsubscriptionError ? err.errors : err);\n  }, []);\n}","map":{"version":3,"sources":["../../src/internal/Subscription.ts"],"names":[],"mappings":"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","sourcesContent":["/** PURE_IMPORTS_START _util_isArray,_util_isObject,_util_isFunction,_util_tryCatch,_util_errorObject,_util_UnsubscriptionError PURE_IMPORTS_END */\nimport { isArray } from './util/isArray';\nimport { isObject } from './util/isObject';\nimport { isFunction } from './util/isFunction';\nimport { tryCatch } from './util/tryCatch';\nimport { errorObject } from './util/errorObject';\nimport { UnsubscriptionError } from './util/UnsubscriptionError';\nvar Subscription = /*@__PURE__*/ (function () {\n    function Subscription(unsubscribe) {\n        this.closed = false;\n        this._parent = null;\n        this._parents = null;\n        this._subscriptions = null;\n        if (unsubscribe) {\n            this._unsubscribe = unsubscribe;\n        }\n    }\n    Subscription.prototype.unsubscribe = function () {\n        var hasErrors = false;\n        var errors;\n        if (this.closed) {\n            return;\n        }\n        var _a = this, _parent = _a._parent, _parents = _a._parents, _unsubscribe = _a._unsubscribe, _subscriptions = _a._subscriptions;\n        this.closed = true;\n        this._parent = null;\n        this._parents = null;\n        this._subscriptions = null;\n        var index = -1;\n        var len = _parents ? _parents.length : 0;\n        while (_parent) {\n            _parent.remove(this);\n            _parent = ++index < len && _parents[index] || null;\n        }\n        if (isFunction(_unsubscribe)) {\n            var trial = tryCatch(_unsubscribe).call(this);\n            if (trial === errorObject) {\n                hasErrors = true;\n                errors = errors || (errorObject.e instanceof UnsubscriptionError ?\n                    flattenUnsubscriptionErrors(errorObject.e.errors) : [errorObject.e]);\n            }\n        }\n        if (isArray(_subscriptions)) {\n            index = -1;\n            len = _subscriptions.length;\n            while (++index < len) {\n                var sub = _subscriptions[index];\n                if (isObject(sub)) {\n                    var trial = tryCatch(sub.unsubscribe).call(sub);\n                    if (trial === errorObject) {\n                        hasErrors = true;\n                        errors = errors || [];\n                        var err = errorObject.e;\n                        if (err instanceof UnsubscriptionError) {\n                            errors = errors.concat(flattenUnsubscriptionErrors(err.errors));\n                        }\n                        else {\n                            errors.push(err);\n                        }\n                    }\n                }\n            }\n        }\n        if (hasErrors) {\n            throw new UnsubscriptionError(errors);\n        }\n    };\n    Subscription.prototype.add = function (teardown) {\n        if (!teardown || (teardown === Subscription.EMPTY)) {\n            return Subscription.EMPTY;\n        }\n        if (teardown === this) {\n            return this;\n        }\n        var subscription = teardown;\n        switch (typeof teardown) {\n            case 'function':\n                subscription = new Subscription(teardown);\n            case 'object':\n                if (subscription.closed || typeof subscription.unsubscribe !== 'function') {\n                    return subscription;\n                }\n                else if (this.closed) {\n                    subscription.unsubscribe();\n                    return subscription;\n                }\n                else if (typeof subscription._addParent !== 'function') {\n                    var tmp = subscription;\n                    subscription = new Subscription();\n                    subscription._subscriptions = [tmp];\n                }\n                break;\n            default:\n                throw new Error('unrecognized teardown ' + teardown + ' added to Subscription.');\n        }\n        var subscriptions = this._subscriptions || (this._subscriptions = []);\n        subscriptions.push(subscription);\n        subscription._addParent(this);\n        return subscription;\n    };\n    Subscription.prototype.remove = function (subscription) {\n        var subscriptions = this._subscriptions;\n        if (subscriptions) {\n            var subscriptionIndex = subscriptions.indexOf(subscription);\n            if (subscriptionIndex !== -1) {\n                subscriptions.splice(subscriptionIndex, 1);\n            }\n        }\n    };\n    Subscription.prototype._addParent = function (parent) {\n        var _a = this, _parent = _a._parent, _parents = _a._parents;\n        if (!_parent || _parent === parent) {\n            this._parent = parent;\n        }\n        else if (!_parents) {\n            this._parents = [parent];\n        }\n        else if (_parents.indexOf(parent) === -1) {\n            _parents.push(parent);\n        }\n    };\n    Subscription.EMPTY = (function (empty) {\n        empty.closed = true;\n        return empty;\n    }(new Subscription()));\n    return Subscription;\n}());\nexport { Subscription };\nfunction flattenUnsubscriptionErrors(errors) {\n    return errors.reduce(function (errs, err) { return errs.concat((err instanceof UnsubscriptionError) ? err.errors : err); }, []);\n}\n//# sourceMappingURL=Subscription.js.map\n"]},"metadata":{},"sourceType":"module"}